<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" 
th:replace="base::Layout(~{::section})">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MovieAI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
   
</head>
<body>
<!-- Header with Navbar -->
<section>
<!-- Movie Detail Section -->
<div class="container mt-4">
    <div class="row">
        <!-- Adjusted column sizes for better alignment -->
        <div class="col-md-4">
            <!-- Movie Poster -->
            <img th:src="@{'/images/posters' + ${movie.posterPath} + '.jpg'}" class="img-fluid rounded" alt="Movie Poster" width="350" height="550">
        </div>
        <div class="col-md-7">
            <!-- Movie Title -->
       <h2 th:text="${movie.originalTitle}" class="fw-bold mb-3" style="color: #FFD700;"></h2>

            <!-- Movie Description -->
            <p th:text="${movie.overview}" class="lead"></p>
            <!-- Details -->
            
           
            <p><strong>Ngày ra mắt:</strong> <span th:text="${movie.releaseDate}"></span></p>
            
            
   <p><strong>Thời Lượng:</strong> <span th:text="${T(com.libray.MovieAi.utils.TimeUtil).formatRuntime(movie.runtime)}"></span></p>



            <p><strong>Điểm đánh giá:</strong> <span th:text="${movie.voteAverage}"></span></p>
           

    
    <p><strong>Type:</strong> 
        <span th:each="genre, iterStat : ${genres}">
            <span th:text="${genre.name}"></span>
            <span th:if="${!iterStat.last}">,</span>
        </span>
    </p>

            <!-- Back Button -->
           <div class="d-grid mt-3" style="margin-top:50px;">
    <a th:href="@{'/movies/watch/' + ${movie.id}}"  class="btn btn-lg btn-danger">Xem Phim</a>
</div>



        </div>
    </div>
</div>
<!-- Maybe You Like Section -->
<div class="container mt-4">
    <h3>Maybe You Like</h3>
    <div class="row" id="maybeYouLikeMovies">
        <!-- Movies will be dynamically added here -->
    </div>
</div>

<!-- Comment Section -->
<div class="container mt-4">
    <h3>Bình Luận</h3>
    <!-- Historical comments -->
    <div class="mb-3">
       
        <ul id="historicalComments">
            <!-- Historical comments will be dynamically added here -->
        </ul>
    </div>
    <!-- New Comment Form -->
    <div class="mb-3">
        <h5>Thêm Bình Luận</h5>
        <form id="commentForm">
            <div class="mb-3">
                <label for="comment" class="form-label">Nội Dung:</label>
                <textarea class="form-control" id="comment" rows="3"></textarea>
            </div>
           <div class="mb-3">
    <label for="rating" class="form-label">Rating (1-10):</label>
    <input type="number" class="form-control form-control-sm" id="rating" min="1" max="10" step="1">
</div>

            <button type="submit" class="btn btn-primary">Gửi</button>
        </form>
    </div>
</div>
</section>
 
<!-- Bootstrap Bundle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript to fetch random movies and populate "Maybe You Like" section -->
<script>
async function fetchRandomMovies() {
    const response = await fetch('/movies/random?limit=5');
    const data = await response.json();
    return data;
}

async function renderRandomMovies() {
    const randomMovies = await fetchRandomMovies();
    const maybeYouLikeMoviesContainer = document.getElementById('maybeYouLikeMovies');
    randomMovies.forEach(movie => {
        const card = document.createElement('div');
        card.classList.add('col-md-2');
        card.innerHTML = `
            <div class="card mb-3">
                <img src="/images/${movie.imageFileName}" class="card-img-top fit-image movie-image" alt="Movie Image" data-movie-id="${movie.id}">
                <div class="card-body">
                    <h5 class="card-title">${movie.title}</h5>
                </div>
            </div>
        `;
        maybeYouLikeMoviesContainer.appendChild(card);
    });
    
    // Add event listener to each movie image
    const movieImages = document.querySelectorAll('.movie-image');
    movieImages.forEach(image => {
        image.addEventListener('click', () => {
            const movieId = image.dataset.movieId;
            window.location.href = `/movies/detail/${movieId}`;
        });
    });
}

document.addEventListener('DOMContentLoaded', renderRandomMovies);

// JavaScript for handling comment submission
document.getElementById('commentForm').addEventListener('submit', async function(event) {
    event.preventDefault(); // Prevent form submission
    const comment = document.getElementById('comment').value;
    const rating = document.getElementById('rating').value;
    // Add your logic to submit the comment and rating to the server
    // You can use fetch or other methods to send a POST request to the server
    // After successful submission, you may want to reload the page or update the comment section dynamically
});

</script>

<style>
    /* Custom styles for small movie images */
    .fit-image {
        max-width: 100%;
        height: auto;
    }
</style>
